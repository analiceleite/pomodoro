<div class="screensaver-container" [ngClass]="'phase-' + ((timerState$ | async)?.currentPhase || 'work')">
  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Phase Indicator -->
    <div class="phase-section">
      <div class="phase-indicator">
        <mat-icon class="phase-icon">{{ getPhaseIcon((timerState$ | async)?.currentPhase || 'work') }}</mat-icon>
        <span class="phase-title">{{ getPhaseTitle((timerState$ | async)?.currentPhase || 'work') }}</span>
      </div>
    </div>

    <!-- Duration Selector (apenas na fase work) -->
    <div class="duration-selector" *ngIf="(timerState$ | async)?.currentPhase === 'work'">
      <div class="duration-label">
        <mat-icon>timer</mat-icon>
        <span>Duração</span>
      </div>
      <div class="duration-options">
        <button 
          *ngFor="let duration of availableWorkDurations"
          mat-stroked-button
          [class.active]="currentWorkDuration === duration && !showCustomInput"
          (click)="setWorkDuration(duration)"
          [disabled]="(timerState$ | async)?.isRunning">
          {{ getWorkDurationLabel(duration) }}
        </button>
        <button 
          mat-stroked-button
          [class.active]="showCustomInput || !isPresetDuration(currentWorkDuration)"
          (click)="toggleCustomInput()"
          [disabled]="(timerState$ | async)?.isRunning">
          <mat-icon>edit</mat-icon>
        </button>
      </div>
      
      <!-- Custom Duration Input -->
      <div class="custom-duration-input" *ngIf="showCustomInput">
        <input 
          type="number" 
          [(ngModel)]="customDurationInput"
          min="1" 
          max="120" 
          placeholder="Min (1-120)"
          (keyup.enter)="applyCustomDuration()">
        <button mat-flat-button color="primary" (click)="applyCustomDuration()">
          <mat-icon>check</mat-icon>
          OK
        </button>
      </div>
      
      <div class="current-duration-info" *ngIf="!isPresetDuration(currentWorkDuration)">
        <mat-icon>info</mat-icon>
        <span>{{ formatDurationLabel(currentWorkDuration) }}</span>
      </div>
    </div>

    <!-- Central Timer Display -->
    <div class="timer-section">
      <div class="timer-display" [class.pulse]="(timerState$ | async)?.isRunning">
        {{ formattedTime$ | async }}
      </div>

      <!-- Progress Bar -->
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(progress$ | async) || 0"
            [style.background-color]="getPhaseColor((timerState$ | async)?.currentPhase || 'work')">
          </div>
        </div>
        <div class="progress-text">{{ Math.round((progress$ | async) || 0) }}%</div>
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-section">
    <!-- Stats Cards - Layout Horizontal -->
    <div class="stats-grid">
      <div class="stat-card">
        <mat-icon class="stat-icon">check_circle</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ todayStats.cycles || 0 }}</div>
          <div class="stat-label">Ciclos</div>
        </div>
      </div>

      <div class="stat-card">
        <mat-icon class="stat-icon">schedule</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ formatTotalTime(todayStats.totalMinutes || 0) }}</div>
          <div class="stat-label">Foco</div>
        </div>
      </div>

      <div class="stat-card">
        <mat-icon class="stat-icon">today</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ currentDayName }}</div>
          <div class="stat-label">Hoje</div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-section">
      <button mat-fab [color]="(timerState$ | async)?.isRunning ? 'accent' : 'primary'" (click)="toggleTimer()"
        class="main-action-btn" [class.running]="(timerState$ | async)?.isRunning" extended>
        <mat-icon>{{ (timerState$ | async)?.isRunning ? 'pause' : 'play_arrow' }}</mat-icon>
        {{ (timerState$ | async)?.isRunning ? 'Pausar' : 'Iniciar' }}
      </button>

      <!-- Skip Break Button - Only visible during break phases -->
      <button 
        mat-stroked-button 
        color="accent" 
        (click)="skipBreak()" 
        class="skip-break-btn"
        *ngIf="(timerState$ | async)?.currentPhase === 'shortBreak' || (timerState$ | async)?.currentPhase === 'longBreak'">
        <mat-icon>skip_next</mat-icon>
        Pular Pausa
      </button>

      <button mat-stroked-button color="warn" (click)="reset()" class="secondary-action-btn">
        <mat-icon>refresh</mat-icon>
        Resetar
      </button>
    </div>
  </div>
</div>