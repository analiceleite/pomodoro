<div class="screensaver-container" [ngClass]="'phase-' + ((timerState$ | async)?.currentPhase || 'work')">
  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Phase Indicator -->
    <div class="phase-section">
      <div class="phase-indicator">
        <mat-icon class="phase-icon">{{ getPhaseIcon((timerState$ | async)?.currentPhase || 'work') }}</mat-icon>
        <span class="phase-title">{{ getPhaseTitle((timerState$ | async)?.currentPhase || 'work') }}</span>
      </div>
    </div>

    <!-- Duration & Presets Section -->
    <div class="duration-presets-container" *ngIf="(timerState$ | async)?.currentPhase === 'work'">
      <!-- Controls Row -->
      <div class="controls-row">
        <!-- Manual Edit Section -->
        <div class="presets-section">
          <span class="section-label">Manual:</span>
          <div class="presets-inline">
            <button mat-stroked-button class="preset-btn" (click)="toggleCustomInput()"
              [disabled]="(timerState$ | async)?.isRunning || false" matTooltip="Editar duração manualmente">
              {{ currentWorkDuration }}min
              <mat-icon>edit</mat-icon>
            </button>
          </div>
        </div>

        <!-- Visual Separator -->
        <div class="separator"></div>

        <!-- Quick Presets Section -->
        <div class="presets-section">
          <span class="section-label">Atalhos:</span>
          <div class="presets-inline">
            <button *ngFor="let preset of customPresets" class="preset-btn" (click)="applyPreset(preset)"
              [disabled]="(timerState$ | async)?.isRunning || false" matTooltip="Atalho: {{preset}} minutos">
              {{ preset }}
            </button>
          </div>
        </div>

        <!-- Visual Separator -->
        <div class="separator"></div>

        <!-- Config Section -->
        <div class="presets-section">
          <span class="section-label">Configuração:</span>

          <button mat-icon-button class="manage-btn" (click)="togglePresetsManager()"
            [disabled]="(timerState$ | async)?.isRunning || false" matTooltip="Configurar atalhos">
            <mat-icon>settings</mat-icon>
          </button>
        </div>
      </div>

      <!-- Duration Picker Panel -->
      <div class="duration-picker" *ngIf="showDurationSelector">
        <div class="picker-content">
          <div class="select-wrapper">
            <label>Selecione um tempo:</label>
            <select [(ngModel)]="customDurationInput" (change)="onDurationSelectChange(customDurationInput || 0)"
              class="duration-select" [disabled]="(timerState$ | async)?.isRunning || false">
              <option *ngFor="let duration of workDurationOptions" [value]="duration">
                {{ getWorkDurationLabel(duration) }}
              </option>
            </select>
          </div>

          <div class="input-wrapper">
            <label>Ou digite o tempo (1-120 min):</label>
            <div class="input-group">
              <input type="number" [(ngModel)]="customDurationInput"
                (change)="onDurationInputChange(customDurationInput || 0)" min="1" max="120"
                placeholder="Digite em minutos" class="duration-input"
                [disabled]="(timerState$ | async)?.isRunning || false">
              <span class="input-suffix">min</span>
            </div>
          </div>

          <div class="picker-actions">
            <button mat-stroked-button (click)="showDurationSelector = false" class="cancel-btn">
              Cancelar
            </button>
            <button mat-flat-button color="primary" (click)="applyCustomDuration()" class="apply-btn">
              <mat-icon>check</mat-icon>
              Confirmar
            </button>
          </div>
        </div>
      </div>

      <!-- Presets Manager Panel -->
      <div class="presets-manager" *ngIf="showPresetsManager">
        <div class="manager-content">
          <div class="manager-header">
            <h3>Gerenciar Atalhos</h3>
            <button mat-icon-button (click)="showPresetsManager = false" class="close-manager-btn">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          <div class="add-preset-section">
            <label>Novo atalho:</label>
            <div class="add-preset-input">
              <input type="number" [(ngModel)]="newPresetInput" min="1" max="120" placeholder="Minutos"
                (keyup.enter)="addPreset()">
              <button mat-flat-button color="primary" (click)="addPreset()">
                <mat-icon>add</mat-icon>
              </button>
            </div>
          </div>

          <div class="presets-management">
            <label>Atalhos existentes:</label>
            <div class="preset-manager-list">
              <div *ngFor="let preset of customPresets" class="preset-manager-item">
                <span class="preset-value">{{ preset }} min</span>
                <button mat-icon-button (click)="removePreset(preset)" matTooltip="Remover">
                  <mat-icon>delete_outline</mat-icon>
                </button>
              </div>
            </div>
          </div>

          <button mat-button (click)="showPresetsManager = false" class="manager-close-btn" fullWidth>
            Fechar
          </button>
        </div>
      </div>
    </div>

    <!-- Central Timer Display -->
    <div class="timer-section">
      <div class="timer-display" [class.pulse]="(timerState$ | async)?.isRunning">
        {{ formattedTime$ | async }}
      </div>

      <!-- Progress Bar -->
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="(progress$ | async) || 0"
            [style.background-color]="getPhaseColor((timerState$ | async)?.currentPhase || 'work')">
          </div>
        </div>
        <div class="progress-text">{{ Math.round((progress$ | async) || 0) }}%</div>
      </div>
    </div>
  </div>

  <!-- Bottom Section -->
  <div class="bottom-section">
    <!-- Stats Cards - Layout Horizontal -->
    <div class="stats-grid">
      <div class="stat-card">
        <mat-icon class="stat-icon">check_circle</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ todayStats.cycles || 0 }}</div>
          <div class="stat-label">Ciclos</div>
        </div>
      </div>

      <div class="stat-card">
        <mat-icon class="stat-icon">schedule</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ formatTotalTime(todayStats.totalMinutes || 0) }}</div>
          <div class="stat-label">Foco</div>
        </div>
      </div>

      <div class="stat-card">
        <mat-icon class="stat-icon">today</mat-icon>
        <div class="stat-info">
          <div class="stat-value">{{ currentDayName }}</div>
          <div class="stat-label">Hoje</div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-section">
      <button mat-fab [color]="(timerState$ | async)?.isRunning ? 'accent' : 'primary'" (click)="toggleTimer()"
        class="main-action-btn" [class.running]="(timerState$ | async)?.isRunning" extended>
        <mat-icon>{{ (timerState$ | async)?.isRunning ? 'pause' : 'play_arrow' }}</mat-icon>
        {{ (timerState$ | async)?.isRunning ? 'Pausar' : 'Iniciar' }}
      </button>

      <!-- Skip Break Button - Only visible during break phases -->
      <button mat-stroked-button color="accent" (click)="skipBreak()" class="skip-break-btn"
        *ngIf="(timerState$ | async)?.currentPhase === 'shortBreak' || (timerState$ | async)?.currentPhase === 'longBreak'">
        <mat-icon>skip_next</mat-icon>
        Pular Pausa
      </button>

      <button mat-stroked-button color="warn" (click)="reset()" class="secondary-action-btn">
        <mat-icon>refresh</mat-icon>
        Resetar
      </button>
    </div>
  </div>
</div>